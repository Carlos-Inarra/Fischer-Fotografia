from flask import render_template,url_for,request,redirect,make_response,session
from Projeto_site import app
from functools import wraps


def Logado(funcao_original):
    @wraps(funcao_original)
    def wrapper(*args, **kwargs):
        try:
            a = session["usuario"]
        except:
            a = ""
        if a:
            resultado = funcao_original(*args, **kwargs)
        else:
            return redirect(url_for("login"))
        return resultado
    return wrapper

@app.route('/login', methods=['GET'])
def login():
    resp = make_response("Sucess")
    resp.set_cookie('Usuario', 'Carlos Inarra')
    return render_template("Cadastro.html")


@app.route('/',methods=['GET'])
@Logado
def Home():       
    return render_template("Base.html")


@app.route('/Admin',methods=['POST','GET'])
@Logado
def Admin(): 
    alteracao = []
    a = ""  
    if request.method == "GET":
        return render_template("Admin.html", a=a)   
    elif request.method == "POST":
        for i in range(1, 5):
            if request.files[f"Carrossel{i}"].filename != "":
                request.files[f"Carrossel{i}"].save(rf"C:\Users\CarlosInarra\Documents\Sites-modelos\Projeto_site\static\Imagens\img{i}.jpg")
                alteracao.append(1)
            else:
                pass    
        a = "Alterações Feitas" if len(alteracao) >= 1 else ""  
        return render_template("Admin.html",a =a)
    
@app.route('/Mapatestando',methods=['GET'])
def MapaTestando():
    import pandas as pd
    UF = [{'nome': 'Acre',
  'sigla': 'AC',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -67.8249,
  'Lat': -9.9754},
 {'nome': 'Alagoas',
  'sigla': 'AL',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -35.7196,
  'Lat': -9.6474},
 {'nome': 'Amapá',
  'sigla': 'AP',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -51.0694,
  'Lat': 0.0349},
 {'nome': 'Amazonas',
  'sigla': 'AM',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -60.0217,
  'Lat': -3.119},
 {'nome': 'Bahia',
  'sigla': 'BA',
  'licenciados': {'Nome': ['Americatur (Alltour)',
    'Império das Passagens',
    'Interact Group',
    'Mat Mundial',
    'SB Travel',
    'Salvatur',
    'VCA Viagens (App Viagens)'],
   'CNPJ': ['04784895000153',
    '32103675000152',
    '33839631000158',
    '64601925000170',
    '11028785000127',
    '14693949000129',
    '27957529000154'],
   'Endereco': []},
  'Long': -38.5014,
  'Lat': -12.9714},
 {'nome': 'Ceará',
  'sigla': 'CE',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -38.5431,
  'Lat': -3.7172},
 {'nome': 'Brasília',
  'sigla': 'DF',
  'licenciados': {'Nome': ['AGM', 'Bancorbrás', 'RM Turismo (P&P)', 'SLC'],
   'CNPJ': ['24929614000110',
    '\nsobonº03635174000119',
    '06955770000174',
    '04462643000108'],
   'Endereco': []},
  'Long': -47.9218,
  'Lat': -15.8267},
 {'nome': 'Espírito Santo',
  'sigla': 'ES',
  'licenciados': {'Nome': ['CHR (Flytte)'],
   'CNPJ': ['31042141000109'],
   'Endereco': []},
  'Long': -40.3128,
  'Lat': -20.3155},
 {'nome': 'Goiás',
  'sigla': 'GO',
  'licenciados': {'Nome': ['Universal Goiania (Uniglobe)'],
   'CNPJ': ['35348129000170'],
   'Endereco': []},
  'Long': -49.2643,
  'Lat': -16.6864},
 {'nome': 'Maranhão',
  'sigla': 'MA',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -44.2826,
  'Lat': -2.5387},
 {'nome': 'Mato Grosso',
  'sigla': 'MT',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -56.0949,
  'Lat': -15.5989},
 {'nome': 'Mato Grosso do Sul',
  'sigla': 'MS',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -54.6466,
  'Lat': -20.4428},
 {'nome': 'Minas Gerais',
  'sigla': 'MG',
  'licenciados': {'Nome': ['Lazertur',
    'Makro',
    'PRS (Iinovi)',
    'Trade',
    'Ártico'],
   'CNPJ': ['38575072000130',
    '16403353000172',
    '19138279000100',
    '05586365000163',
    '11067621000109'],
   'Endereco': []},
  'Long': -43.9333,
  'Lat': -19.9167},
 {'nome': 'Pará',
  'sigla': 'PA',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -48.5044,
  'Lat': -1.4558},
 {'nome': 'Paraíba',
  'sigla': 'PB',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -34.8631,
  'Lat': -7.115},
 {'nome': 'Paraná',
  'sigla': 'PR',
  'licenciados': {'Nome': ['Asia Tour',
    'Stabia',
    'Travellog',
    'Valentin Turismo'],
   'CNPJ': ['30313587000150',
    '10586640000189',
    '35654890000130',
    '07818643000196'],
   'Endereco': []},
  'Long': -49.2719,
  'Lat': -25.4296},
 {'nome': 'Pernambuco',
  'sigla': 'PE',
  'licenciados': {'Nome': ['Casa Forte (Fortour)', 'Luck', 'Pontestur'],
   'CNPJ': ['35626431000142', '10866549000117', '11843042000100'],
   'Endereco': []},
  'Long': -34.877,
  'Lat': -8.0476},
 {'nome': 'Piauí',
  'sigla': 'PI',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -42.8034,
  'Lat': -5.0919},
 {'nome': 'Rio de Janeiro',
  'sigla': 'RJ',
  'licenciados': {'Nome': ['CP Turismo',
    'DLS',
    'Dynamo',
    'Fantasytour (Travel Place)',
    'HR Turismo (Portofino)',
    'Milessis',
    'Promotional',
    'Reisen',
    'RioTravel',
    'Solid',
    'Tropical',
    'Vision Travel',
    'Wings'],
   'CNPJ': ['31578859000106',
    '07076265000112',
    '08961844000100',
    '30838742000151',
    '06256161000127',
    '01891402000196',
    '40434458000173',
    '17031425000160',
    '34121202000103',
    '00622682000174',
    '05858159000165',
    '20261646000130',
    '01047936000130'],
   'Endereco': []},
  'Long': -43.1729,
  'Lat': -22.9068},
 {'nome': 'Rio Grande do Norte',
  'sigla': 'RN',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -35.211,
  'Lat': -5.7945},
 {'nome': 'Rio Grande do Sul',
  'sigla': 'RS',
  'licenciados': {'Nome': ['CH Turismo', 'Mercatur'],
   'CNPJ': ['14675286000110', '8710026900028'],
   'Endereco': []},
  'Long': -51.2287,
  'Lat': -30.0277},
 {'nome': 'Rondônia',
  'sigla': 'RO',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -63.8999,
  'Lat': -8.7608},
 {'nome': 'Roraima',
  'sigla': 'RR',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -60.6733,
  'Lat': 2.8198},
 {'nome': 'Santa Catarina',
  'sigla': 'SC',
  'licenciados': {'Nome': ['Cosmos', 'Global (T.W.S)', 'Go Inti', 'Ilhatur'],
   'CNPJ': ['76366673000121',
    '09386919000130',
    '52647751000106',
    '80983950000112'],
   'Endereco': []},
  'Long': -48.548,
  'Lat': -27.5954},
 {'nome': 'São Paulo',
  'sigla': 'SP',
  'licenciados': {'Nome': ['Addetur',
    'Alive',
    'Augustus',
    'Capolavoro',
    'Conextravel',
    'Congonhas',
    'Copastur',
    'Costa Brava',
    'Costa Verde',
    'DIX',
    'Day Off',
    "Destinations (Let's Travel)",
    'Hardy',
    'Invicta',
    'Jet Stream',
    'LB Gate (Gate Tour)',
    'Maiorca',
    'NIX',
    'Personal',
    'Quickly (Grupo Alatur JTB)',
    'RB Viagens (Bird)',
    'S.A.S. Corporate',
    'Satguru',
    'Seta',
    'SolFesta',
    'TC Operadora (The Cliente Operadora e Agência de Viagens LTDA)',
    'TEG',
    'Tivoli',
    'Transoceanic (Sobratur)',
    'Trip Soul (R. C. dos Santos Pereira Ltda)',
    'Tristar',
    'Tunibra (New)',
    'Ypy Viagens (Postserv)'],
   'CNPJ': ['01093133000112',
    '12695291000169',
    '43062389000102',
    '01108944000140',
    '07265789000151',
    '72877046000102',
    '43637214000186',
    '59717926000145',
    '51976900000100',
    '24485247000103',
    '33011656000169',
    '10452679000103',
    '57169815000116',
    '0707626500112',
    '54289491000161',
    '27262847000109',
    '60626512000190',
    '11473674000120',
    '10221090000102',
    '15279665000234',
    '19077826000187',
    '22200160000117',
    '15542034000185',
    '21110455000130',
    '55300826000168',
    '06078683000186',
    '73182214000108',
    '57443319000109',
    '46031910000132',
    '26209909000148',
    '57830788000180',
    '39849408000178',
    '00613615000193'],
   'Endereco': []},
  'Long': -46.6333,
  'Lat': -23.5505},
 {'nome': 'Sergipe',
  'sigla': 'SE',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -37.0731,
  'Lat': -10.9472},
 {'nome': 'Tocantins',
  'sigla': 'TO',
  'licenciados': {'Nome': [], 'CNPJ': [], 'Endereco': []},
  'Long': -48.3603,
  'Lat': -10.2128}]
    tabela = pd.DataFrame(UF)
    tabela["Quant"] = tabela["licenciados"].apply(lambda x: len(x['Nome']))
    tabela['Clientes'] = tabela['licenciados'].apply(lambda x: str(x['Nome']).replace(","," |").replace("'",""))
    import plotly.express as px
    df = tabela
    fig = px.scatter_geo(df,lon=df["Long"],lat=df["Lat"],color="sigla",size_max=25
                , size="Quant",hover_name="nome",hover_data={"Lat":False,"Long":False,"Quant":True,"Clientes":True},
                 projection="robinson",scope="south america",center={"lat":-2.2350,"lon":-36.9253})
    graph_html = fig.to_html(full_html=False,standalone=True)
    
    # Renderize o template passando o HTML do gráfico
    return render_template('index.html', graph_html=graph_html)
